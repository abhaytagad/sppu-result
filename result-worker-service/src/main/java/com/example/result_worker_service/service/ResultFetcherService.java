package com.example.result_worker_service.service;

import com.example.result_worker_service.model.ResultRequest;
import com.openhtmltopdf.pdfboxout.PdfRendererBuilder;
import org.springframework.beans.factory.annotation.Autowired;

import org.springframework.http.*;


import org.springframework.stereotype.Service;
import org.springframework.util.LinkedMultiValueMap;
import org.springframework.util.MultiValueMap;
import org.springframework.web.client.RestTemplate;


import java.io.ByteArrayOutputStream;
import java.nio.charset.StandardCharsets;

@Service
public class ResultFetcherService {

    private static final String SPPU_RESULT_URL = "https://onlineresults.unipune.ac.in/SPPU ONLINE RESULT DISPLAY";
    private final String CaptchaImageSTR = "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";
    @Autowired
    private RestTemplate restTemplate;
    @Autowired
    private EmailService emailService;

    public void fetchResult(ResultRequest request) throws Exception {
        
        try {
            // Prepare form data
            MultiValueMap<String, String> formData = new LinkedMultiValueMap<>();
            formData.add("PatternID", request.getPatternID());
            formData.add("PatternName", request.getPatternName());
            formData.add("SeatNo", request.getSeatNo());
            formData.add("MotherName", request.getMotherName());
            formData.add("OrgCaptchaText", request.getOrgCaptchaText());
            formData.add("CaptchaImageSTR",CaptchaImageSTR );
            formData.add("CaptchaText", request.getCaptchaText());

            HttpHeaders headers = new HttpHeaders();
            headers.setContentType(MediaType.APPLICATION_FORM_URLENCODED);
            headers.set("User-Agent", "Mozilla/5.0");
            headers.set("Referer", "https://onlineresults.unipune.ac.in/SPPU ONLINE RESULT DISPLAY");
            

            HttpEntity<MultiValueMap<String, String>> entity = new HttpEntity<>(formData, headers);

            ResponseEntity<String> response = restTemplate.postForEntity(SPPU_RESULT_URL, entity, String.class);

            if (response.getStatusCode() == HttpStatus.OK) {
                byte[] pdfBytes = response.getBody().getBytes(StandardCharsets.ISO_8859_1); // or use response.getBody().getBytes() carefully

                emailService.sendResultEmail(request.getSeatNo(),request.getEmail(), pdfBytes);
                System.out.println("📧 Email sent successfully.");
            } else {
                System.out.println("❌ Failed to fetch result: " + response.getStatusCode());
            }

        } catch (Exception e) {
            System.out.println("❌ Error: " + e.getMessage());
//            emailService.sendResultEmail(request.getSeatNo(),request.getEmail(), null);
            e.printStackTrace();
        }
    }

    private byte[] convertHtmlToPdf(String html) throws Exception {
        ByteArrayOutputStream outputStream = new ByteArrayOutputStream();

        PdfRendererBuilder builder = new PdfRendererBuilder();
        builder.withHtmlContent(html, null);
        builder.toStream(outputStream);
        builder.run();

        return outputStream.toByteArray();
    }
}
